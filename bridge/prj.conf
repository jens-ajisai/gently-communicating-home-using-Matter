#################
# Debugging
#################
# appends -std=gnu++20 while CPP20 results in a compile error Building with unsupported C++ standard
# CONFIG_STD_CPP2A=y
CONFIG_STD_CPP14=y

# Debug information
CONFIG_DEBUG=n
CONFIG_DEBUG_OPTIMIZATIONS=n
CONFIG_DEBUG_INFO=y
CONFIG_DEBUG_THREAD_INFO=y
CONFIG_EXCEPTION_STACK_TRACE=y
CONFIG_ASSERT=y
CONFIG_ASSERT_VERBOSE=y
CONFIG_THREAD_NAME=y
CONFIG_THREAD_MONITOR=y
CONFIG_STACK_USAGE=y
CONFIG_MPU_STACK_GUARD=y
CONFIG_RESET_ON_FATAL_ERROR=y


#################
# Memory settings
#################
CONFIG_ISR_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=8192
# default 2200 if BT_SETTINGS
CONFIG_BT_RX_STACK_SIZE=3072
CONFIG_MAIN_STACK_SIZE=8192


#################
# Matter
#################
CONFIG_CHIP=y
CONFIG_CHIP_PROJECT_CONFIG="src/chip_project_config.h"

CONFIG_CHIP_ENABLE_PAIRING_AUTOSTART=y
CONFIG_CHIP_OTA_REQUESTOR=n
CONFIG_CHIP_NFC_COMMISSIONING=n
CONFIG_CHIP_QSPI_NOR=n
# Factory data
CONFIG_CHIP_FACTORY_DATA=n
CONFIG_CHIP_FACTORY_DATA_BUILD=n
# All commented out because with a different discriminator, commissioning on Macs does not work anymore.
#CONFIG_CHIP_FACTORY_DATA_MERGE_WITH_FIRMWARE=y
#CONFIG_CHIP_FACTORY_DATA_USE_DEFAULT_CERTS=y
#CONFIG_CHIP_DEVICE_SERIAL_NUMBER="1"
#CONFIG_CHIP_DEVICE_VENDOR_ID=65521
#CONFIG_CHIP_DEVICE_VENDOR_NAME="J"
# 32770 == 0x8002 (example bridge)
#CONFIG_CHIP_DEVICE_PRODUCT_ID=32770
#CONFIG_CHIP_DEVICE_PRODUCT_NAME="Matter IoT Bridge"
#CONFIG_CHIP_DEVICE_MANUFACTURING_DATE="2023-11-15"
#CONFIG_CHIP_DEVICE_HARDWARE_VERSION=1
#CONFIG_CHIP_DEVICE_HARDWARE_VERSION_STRING="1.0"
#CONFIG_CHIP_DEVICE_DISCRIMINATOR=0xF01

## since the bootloader is larger due to the USB CDC, it was required to reduce the storage to 0x1000.
## This is no multiple of 0x4000, which is a requirement for flash write protection.
## See modules/lib/matter/src/platform/nrfconnect/FactoryDataProvider.h:63:44: 
## error: static assertion failed: FPROTECT memory block, which contains factory datapartition overlaps with the settings partition.
## Probably your settings partition size is not a multipleof the atomic FPROTECT block size of 0x4000kB
# CONFIG_CHIP_FACTORY_DATA_WRITE_PROTECT=n


####################################
# Bluetooth Low Energy configuration
####################################
CONFIG_BT=y
CONFIG_BT_CENTRAL=y
CONFIG_BT_SCAN=y
CONFIG_BT_SCAN_FILTER_ENABLE=y
CONFIG_BT_SCAN_ADDRESS_CNT=1
CONFIG_BT_SCAN_UUID_CNT=2
CONFIG_BT_GATT_CLIENT=y
CONFIG_BT_GATT_DM=y

CONFIG_BT_DEVICE_NAME="MatterBridge"

## Security
CONFIG_BT_SMP=y
CONFIG_BT_MAX_CONN=2
CONFIG_BT_MAX_PAIRED=2
# Required to skip InitRandomStaticAddress() in modules/lib/matter/src/platform/Zephyr/BLEManagerImpl.cpp
# and settings_load() after PlatformMgr().InitChipStack()
CONFIG_BT_PRIVACY=y
CONFIG_BT_SMP_APP_PAIRING_ACCEPT=y

## Enable bonding
CONFIG_BT_SETTINGS=y
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_NVS=y
CONFIG_SETTINGS=y

CONFIG_BT_GATT_DM_DATA_PRINT=y

## Increase packet size
CONFIG_BT_BUF_ACL_RX_SIZE=502
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_L2CAP_TX_MTU=247


#######
# Shell
#######
CONFIG_SHELL=y
CONFIG_SHELL_PROMPT_UART="$ "
CONFIG_SHELL_VT100_COMMANDS=n
CONFIG_SHELL_DEFAULT_TERMINAL_WIDTH=100
CONFIG_SHELL_STACK_SIZE=3168
CONFIG_SHELL_CMD_BUFF_SIZE=128
CONFIG_SHELL_BACKEND_SERIAL_RX_RING_BUFFER_SIZE=128

CONFIG_CHIP_LIB_SHELL=y
CONFIG_BT_SHELL=n


##########
# logging
##########
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y

CONFIG_LOG=y
CONFIG_LOG_MODE_MINIMAL=n
CONFIG_LOG_MODE_DEFERRED=y
CONFIG_LOG_MODE_IMMEDIATE=n
CONFIG_LOG_BUFFER_SIZE=6144
CONFIG_LOG_BACKEND_SHOW_COLOR=n 

CONFIG_LOG_BACKEND_UART=y
CONFIG_SHELL_LOG_BACKEND=n

# Logs when using Debugger.
CONFIG_USE_SEGGER_RTT=n
#CONFIG_LOG_BACKEND_RTT=y
#CONFIG_LOG_BACKEND_RTT_MODE_DROP=y
#CONFIG_LOG_BACKEND_RTT_MESSAGE_SIZE=256
#CONFIG_SHELL_BACKEND_RTT=n
#CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=4096

CONFIG_MATTER_LOG_LEVEL_DBG=y
CONFIG_BT_LOG_LEVEL_INF=y
CONFIG_BT_GATT_LOG_LEVEL_DBG=y


############
# App
############
CONFIG_BRIDGE_BT_RECOVERY_INTERVAL_MS=10000
CONFIG_BRIDGE_BT_RECOVERY_SCAN_TIMEOUT_MS=2000

# Add support for LEDs and buttons on Nordic development kits
CONFIG_DK_LIBRARY=y


#CONFIG_MCUBOOT_BUILD_STRATEGY_SKIP_BUILD=y
#CONFIG_MULTIPROTOCOL_RPMSG_BUILD_STRATEGY_SKIP_BUILD=y
